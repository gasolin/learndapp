"use strict";(self.webpackChunklearndapp=self.webpackChunklearndapp||[]).push([[642],{1504:function(e,t,n){var a=n(7294),p=n(7273);p.Z.initialize({startOnLoad:!0});var l={startOnLoad:!0,logLevel:"fatal",securityLevel:"strict"};t.Z=function(e){var t=e.chart,n=e.config;return p.Z.initialize(Object.assign({},l,n)),(0,a.useEffect)((function(){p.Z.contentLoaded()}),[n]),t?a.createElement("div",{className:"mermaid"},t):null}},5551:function(e,t,n){n.r(t),n.d(t,{frontMatter:function(){return c},contentTitle:function(){return i},metadata:function(){return s},toc:function(){return m},default:function(){return u}});var a=n(7462),p=n(3366),l=(n(7294),n(3905)),r=n(1504),o=["components"],c={title:"\u4f7f\u7528 React \u958b\u767c DApp"},i=void 0,s={unversionedId:"dapp-with-create-react-app",id:"dapp-with-create-react-app",title:"\u4f7f\u7528 React \u958b\u767c DApp",description:"\u5c31\u524d\u9762\u7684\u7d93\u9a57\uff0c\u6211\u5011\u7406\u89e3\u4e00\u500bDApp\u5c08\u6848\u901a\u5e38\u5305\u542b\u4e86\u667a\u80fd\u5408\u7d04\u8207\u7db2\u9801\u524d\u7aef\u5169\u500b\u90e8\u4efd\u3002\u5169\u8005\u4e4b\u9593\u50c5\u900f\u904eABI\u4f86\u4e92\u52d5\u3002\u56e0\u6b64\uff0c\u5728\u4e4b\u5f8c\u7684\u7ae0\u7bc0\u88e1\uff0c\u6211\u5011\u7684\u5c08\u6848\u90fd\u6703\u5305\u542b\u5169\u500b\u7368\u7acb\u7684\u8cc7\u6599\u593e\uff0c\u5206\u5225\u653e\u7f6e\u667a\u80fd\u5408\u7d04(contract)\u8207\u7db2\u9801\u524d\u7aef(web)\u7684\u90e8\u4efd\u3002",source:"@site/docs/dapp-with-create-react-app.md",sourceDirName:".",slug:"/dapp-with-create-react-app",permalink:"/learndapp/dapp-with-create-react-app",editUrl:"https://github.com/facebook/docusaurus/edit/master/website/docs/dapp-with-create-react-app.md",tags:[],version:"current",frontMatter:{title:"\u4f7f\u7528 React \u958b\u767c DApp"},sidebar:"docs",previous:{title:"\u4f7f\u7528 Webpack \u7de8\u8b6f DApp",permalink:"/learndapp/dapp_with_webpack"}},m=[{value:"\u5efa\u7acb\u667a\u80fd\u5408\u7d04\u8cc7\u6599\u593e",id:"\u5efa\u7acb\u667a\u80fd\u5408\u7d04\u8cc7\u6599\u593e",children:[],level:2},{value:"\u5728 MetaMask \u4e2d\u5c0e\u5165\u4ee3\u5e63",id:"\u5728-metamask-\u4e2d\u5c0e\u5165\u4ee3\u5e63",children:[],level:2},{value:"\u5efa\u7acb DApp\u8cc7\u6599\u593e",id:"\u5efa\u7acb-dapp\u8cc7\u6599\u593e",children:[{value:"\u900f\u904e\u7db2\u9801\u9023\u63a5\u667a\u80fd\u5408\u7d04",id:"\u900f\u904e\u7db2\u9801\u9023\u63a5\u667a\u80fd\u5408\u7d04",children:[],level:3},{value:"\u9023\u4e0a\u4e59\u592a\u574a\u7db2\u8def",id:"\u9023\u4e0a\u4e59\u592a\u574a\u7db2\u8def",children:[{value:"\u8b1b\u89e3",id:"\u8b1b\u89e3",children:[],level:4}],level:3},{value:"App.js",id:"appjs",children:[{value:"\u8b1b\u89e3",id:"\u8b1b\u89e3-1",children:[],level:4}],level:3}],level:2},{value:"\u53c3\u8003\u8cc7\u6599",id:"\u53c3\u8003\u8cc7\u6599",children:[],level:2}],d={toc:m};function u(e){var t=e.components,n=(0,p.Z)(e,o);return(0,l.kt)("wrapper",(0,a.Z)({},d,n,{components:t,mdxType:"MDXLayout"}),(0,l.kt)("p",null,"\u5c31\u524d\u9762\u7684\u7d93\u9a57\uff0c\u6211\u5011\u7406\u89e3\u4e00\u500bDApp\u5c08\u6848\u901a\u5e38\u5305\u542b\u4e86",(0,l.kt)("inlineCode",{parentName:"p"},"\u667a\u80fd\u5408\u7d04"),"\u8207",(0,l.kt)("inlineCode",{parentName:"p"},"\u7db2\u9801\u524d\u7aef"),"\u5169\u500b\u90e8\u4efd\u3002\u5169\u8005\u4e4b\u9593\u50c5\u900f\u904eABI\u4f86\u4e92\u52d5\u3002\u56e0\u6b64\uff0c\u5728\u4e4b\u5f8c\u7684\u7ae0\u7bc0\u88e1\uff0c\u6211\u5011\u7684\u5c08\u6848\u90fd\u6703\u5305\u542b\u5169\u500b\u7368\u7acb\u7684\u8cc7\u6599\u593e\uff0c\u5206\u5225\u653e\u7f6e",(0,l.kt)("inlineCode",{parentName:"p"},"\u667a\u80fd\u5408\u7d04"),"(contract)\u8207",(0,l.kt)("inlineCode",{parentName:"p"},"\u7db2\u9801\u524d\u7aef"),"(web)\u7684\u90e8\u4efd\u3002"),(0,l.kt)(r.Z,{chart:"\ngraph LR\nsubgraph \u4f7f\u7528\u8005\n  \u700f\u89bd\u5668[DApp\u76f8\u5bb9\u700f\u89bd\u5668]\n  \u52a0\u5bc6\u4ee3\u5e63\u9322\u5305\n  subgraph \u524d\u7aef\n    \u7db2\u9801[\u7db2\u9801\u61c9\u7528]\n  end\nend\nsubgraph ethereum\n  Contract[\u667a\u80fd\u5408\u7d04]\nend\n\u7db2\u9801 --\x3e \u52a0\u5bc6\u4ee3\u5e63\u9322\u5305\n\u52a0\u5bc6\u4ee3\u5e63\u9322\u5305 -- ABI --\x3e Contract\nContract -- ABI --\x3e \u7db2\u9801\n\u7db2\u9801 --- \u700f\u89bd\u5668\n",mdxType:"Mermaid"}),(0,l.kt)("h2",{id:"\u5efa\u7acb\u667a\u80fd\u5408\u7d04\u8cc7\u6599\u593e"},"\u5efa\u7acb\u667a\u80fd\u5408\u7d04\u8cc7\u6599\u593e"),(0,l.kt)("p",null,"\u9019\u908a\u4e00\u6a23\u4f7f\u7528 truffle \u4f86\u5efa\u7acb\u667a\u80fd\u5408\u7d04\u8cc7\u6599\u593e\u3002\u9996\u5148\u5efa\u7acb",(0,l.kt)("inlineCode",{parentName:"p"},"hello_react_dapp"),"\u5c08\u6848\u8cc7\u6599\u593e\u3002"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-sh"},"$ mkdir hello_react_dapp\n$ cd hello_react_dapp\n")),(0,l.kt)("p",null,"\u63a5\u8457\u5728\u5c08\u6848\u8cc7\u6599\u593e\u4e2d\u5efa\u7acb",(0,l.kt)("inlineCode",{parentName:"p"},"contracts"),"\u8cc7\u6599\u593e\u3002"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-sh"},"$ mkdir contracts\n$ cd contracts\n$ truffle init\n")),(0,l.kt)("p",null,"\u5f9e\u5176\u4ed6\u7bc4\u4f8b\u4e2d\u628a",(0,l.kt)("inlineCode",{parentName:"p"},"contracts/HelloToken.sol"),"\u3001",(0,l.kt)("inlineCode",{parentName:"p"},"migrations/4_deploy_hellotoken.js"),"\u3001",(0,l.kt)("inlineCode",{parentName:"p"},"package.json"),"\u3001",(0,l.kt)("inlineCode",{parentName:"p"},"truffle.js"),"\u9019\u5e7e\u500b\u6a94\u6848\u8907\u88fd\u5230",(0,l.kt)("inlineCode",{parentName:"p"},"hello_react_dapp/contracts"),"\u8cc7\u6599\u593e\u4e0b\uff0c\u518d\u57f7\u884c",(0,l.kt)("inlineCode",{parentName:"p"},"npm install"),"\u547d\u4ee4\u5b89\u88dd\u76f8\u95dc\u51fd\u5f0f\u5eab\u3002\u5b89\u88dd\u597d\u5f8c\u53ef\u4ee5\u4f7f\u7528",(0,l.kt)("inlineCode",{parentName:"p"},"truffle compile"),"\u6216",(0,l.kt)("inlineCode",{parentName:"p"},"truffle migrate"),"\u547d\u4ee4\u7de8\u8b6f\u6216\u90e8\u7f72",(0,l.kt)("inlineCode",{parentName:"p"},"HelloToken"),"\u5408\u7d04\u3002"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre"},"$ npm install\n$ truffle migrate\n")),(0,l.kt)("p",null,"\u5728\u7de8\u8b6f\u6216\u90e8\u7f72\u5408\u7d04\u5f8c\uff0c\u9700\u8a18\u4e0b",(0,l.kt)("inlineCode",{parentName:"p"},"HelloToken"),"\u5408\u7d04\u90e8\u7f72\u7684\u5730\u5740\u3002\u6b64\u5916\uff0c\u5728",(0,l.kt)("inlineCode",{parentName:"p"},"build/contracts"),"\u8cc7\u6599\u593e\u4e0b\u53ef\u4ee5\u770b\u5230\u7522\u751f\u7684",(0,l.kt)("inlineCode",{parentName:"p"},"HelloToken.json"),"\u6a94\u3002\u88e1\u9762\u5305\u542b",(0,l.kt)("inlineCode",{parentName:"p"},"HelloToken.json"),"\u667a\u80fd\u5408\u7d04\u7684ABI\u3002\u9019\u5169\u500b\u8cc7\u6599\u5728DApp\u4e2d\u5c07\u6703\u7528\u5230\u3002"),(0,l.kt)("p",null,"{% mermaid %}\ngraph LR\nsubgraph \u672c\u5730\u958b\u767c\u6a5f\u5668\ncotracts/cotracts/**.sol -- compile --\x3e bytecode","[Contract Bytecode]","\nend"),(0,l.kt)("p",null,"subgraph ethereum\nContract\nend"),(0,l.kt)("p",null,"bytecode -- migrate --\x3e Contract\n{% endmermaid %}"),(0,l.kt)("h2",{id:"\u5728-metamask-\u4e2d\u5c0e\u5165\u4ee3\u5e63"},"\u5728 MetaMask \u4e2d\u5c0e\u5165\u4ee3\u5e63"),(0,l.kt)("p",null,"\u7167\u524d\u9762\u7ae0\u7bc0\u8aaa\u660e\u5728MetaMask\u4e2d\u52a0\u5165",(0,l.kt)("inlineCode",{parentName:"p"},"ganache"),"\u7684\u9810\u8a2d\u5e33\u6236\uff0c\u4e26\u8f38\u5165\u5408\u7d04\u5730\u5740\u4ee5\u52a0\u5165\u81ea\u8a02\u7684",(0,l.kt)("inlineCode",{parentName:"p"},"HelloToekn"),"\u4ee3\u5e63\u3002"),(0,l.kt)("p",null,(0,l.kt)("img",{parentName:"p",src:"https://i.imgur.com/hSruOUQl.png",alt:"Imgur"})),(0,l.kt)("h2",{id:"\u5efa\u7acb-dapp\u8cc7\u6599\u593e"},"\u5efa\u7acb DApp\u8cc7\u6599\u593e"),(0,l.kt)("p",null,"\u5efa\u7acb",(0,l.kt)("inlineCode",{parentName:"p"},"hello_react_dapp"),"\u8cc7\u6599\u593e"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-sh"},"$ mkdir hello_react_dapp\n$ cd hello_react_dapp\n")),(0,l.kt)("p",null,"\u4f7f\u7528",(0,l.kt)("inlineCode",{parentName:"p"},"npx create-react-app"),"\u547d\u4ee4\u4f86\u5efa\u7acb",(0,l.kt)("inlineCode",{parentName:"p"},"web"),"\u8cc7\u6599\u593e\u3002",(0,l.kt)("inlineCode",{parentName:"p"},"Ethjs"),"\uff08\u652f\u63f4promise\u4e14\u76f8\u5c0d\u7a69\u5b9a\uff09\u3002"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-sh"},"$ npx create-react-app web\n$ cd web\n$ npm install --save ethjs\n$ npm install\n")),(0,l.kt)("p",null,"\u9019\u6642\u5df2\u53ef\u4f7f\u7528",(0,l.kt)("inlineCode",{parentName:"p"},"npm start"),"\u547d\u4ee4\u958b\u555f\u9810\u8a2d\u7db2\u9801\uff08\u4f46\u9084\u6c92\u9023\u63a5\u5230\u667a\u80fd\u5408\u7d04\uff09\u3002"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-sh"},"npm start\n")),(0,l.kt)("p",null,"\u57f7\u884c",(0,l.kt)("inlineCode",{parentName:"p"},"npm start"),"\u547d\u4ee4\u5f8c\u6703\u5728\u672c\u6a5f\u958b\u555f\u4e00\u500b\u7db2\u9801\u4f3a\u670d\u5668\uff0c\u4e26\u6703\u5728\u4fee\u6539",(0,l.kt)("inlineCode",{parentName:"p"},"web"),"\u8cc7\u6599\u593e\u4e2d\u7684\u5167\u5bb9\u6642\u81ea\u52d5\u518d\u6b21\u7de8\u8b6f\u3002\u5b8c\u6210\u6642\u53ef\u4f7f\u7528",(0,l.kt)("inlineCode",{parentName:"p"},"npm build"),"\u547d\u4ee4\u8f38\u51fa\u7db2\u9801\u6210\u54c1\u3002"),(0,l.kt)("p",null,(0,l.kt)("inlineCode",{parentName:"p"},"npx"),"\u662f",(0,l.kt)("inlineCode",{parentName:"p"},"npm"),"\u63d0\u4f9b\u7684\u65b0\u529f\u80fd\u3002\u904e\u53bb\u8981\u57f7\u884c",(0,l.kt)("inlineCode",{parentName:"p"},"create-react-app"),"\u6216",(0,l.kt)("inlineCode",{parentName:"p"},"gulp"),"\u7b49\u6307\u4ee4\u6642\uff0c\u9700\u8981\u5148\u4f7f\u7528",(0,l.kt)("inlineCode",{parentName:"p"},"npm install -g xxx")," \u5c07\u9019\u4e9b\u6307\u4ee4\u5b89\u88dd\u5230 global namespace\u3002\u5c0d\u65bc",(0,l.kt)("inlineCode",{parentName:"p"},"create-react-app"),"\u9019\u7a2e\u7522\u751f\u5668\uff08generator\uff09\u6027\u8cea\u7684\u547d\u4ee4\uff0c\u7531\u65bc\u53ea\u6709\u5728\u5efa\u7acb\u65b0\u5c08\u6848\u6642\u6703\u7528\u5230\u3002\u56e0\u70ba",(0,l.kt)("inlineCode",{parentName:"p"},"create-react-app"),"\u66f4\u65b0\u983b\u7e41\uff0c\u4e0b\u6b21\u4e0d\u77e5\u4ec0\u9ebc\u6642\u5019\u8981\u7528\u5230\u6642\uff0c\u53c8\u8981\u91cd\u65b0\u5347\u7d1a\u4e00\u6b21\u624d\u80fd\u4f7f\u7528\u5230\u6700\u65b0\u7684\u529f\u80fd\u3002\u73fe\u5728\u7528",(0,l.kt)("inlineCode",{parentName:"p"},"npx"),"\u53ef\u4ee5\u5373\u6642\u4e0b\u8f09\u4e26\u57f7\u884c node \u6307\u4ee4\uff0c\u800c\u4e0d\u9700\u8981\u9810\u5148\u5b89\u88dd\u3002"),(0,l.kt)("p",null,"{% mermaid %}\ngraph LR"),(0,l.kt)("p",null,"subgraph \u4f7f\u7528\u8005\n\u700f\u89bd\u5668","[DApp\u76f8\u5bb9\u700f\u89bd\u5668]","\n\u52a0\u5bc6\u4ee3\u5e63\u9322\u5305\nsubgraph \u524d\u7aef\n\u7db2\u9801","[\u7db2\u9801\u61c9\u7528]","\nend\nend"),(0,l.kt)("p",null,"subgraph ethereum\nContract","[\u667a\u80fd\u5408\u7d04]","\nend"),(0,l.kt)("p",null,"subgraph \u672c\u5730\u958b\u767c\u6a5f\u5668\nweb/src/** -- build --\x3e \u7db2\u98011","[\u7db2\u9801]","\nend"),(0,l.kt)("p",null,"\u7db2\u9801 --\x3e \u52a0\u5bc6\u4ee3\u5e63\u9322\u5305\n\u52a0\u5bc6\u4ee3\u5e63\u9322\u5305 -- ABI --\x3e Contract\nContract -- ABI --\x3e \u7db2\u9801\n\u7db2\u9801 --- \u700f\u89bd\u5668\n\u7db2\u98011 --\x3e \u7db2\u9801\n{% endmermaid %}"),(0,l.kt)("h3",{id:"\u900f\u904e\u7db2\u9801\u9023\u63a5\u667a\u80fd\u5408\u7d04"},"\u900f\u904e\u7db2\u9801\u9023\u63a5\u667a\u80fd\u5408\u7d04"),(0,l.kt)("p",null,"\u900f\u904e\u7db2\u9801\u9023\u63a5\u667a\u80fd\u5408\u7d04\u9700\u8981\u63d0\u4f9b\u4e09\u500b\u53c3\u6578\uff1a\u5408\u7d04\u6240\u5728\u7684\u7db2\u8def\uff0c\u5408\u7d04\u90e8\u7f72\u7684\u5730\u5740\uff0c\u5408\u7d04\u7684ABI\u3002"),(0,l.kt)("p",null,"\u5c07\u7de8\u8b6f\u597d\u7684 ",(0,l.kt)("inlineCode",{parentName:"p"},"contracts/build/contracts/HelloToken.json"),"\u8907\u88fd\u5230",(0,l.kt)("inlineCode",{parentName:"p"},"web/src/lib/contracts/HelloToken.json"),"\u4e2d\u3002\u4e26\u5728",(0,l.kt)("inlineCode",{parentName:"p"},"src"),"\u76ee\u9304\u4e0b\u5efa\u7acb",(0,l.kt)("inlineCode",{parentName:"p"},"constants.js"),"\u6a94\u6848\uff0c\u5c07\u90e8\u7f72\u597d\u7684",(0,l.kt)("inlineCode",{parentName:"p"},"HelloToken"),"\u5730\u5740\u8907\u88fd\u904e\u4f86\u3002"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-js"},"export const CONTRACT_ADDRESS = '0x345cA3e014Aaf5dcA488057592ee47305D9B3e10';\n")),(0,l.kt)("h3",{id:"\u9023\u4e0a\u4e59\u592a\u574a\u7db2\u8def"},"\u9023\u4e0a\u4e59\u592a\u574a\u7db2\u8def"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-sh"},"npm install --save ethjs\n")),(0,l.kt)("p",null,"\u5efa\u7acb ",(0,l.kt)("inlineCode",{parentName:"p"},"src/web3utils.js")," \u6a94\u6848\uff0c\u5167\u5bb9\u5982\u4e0b"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-js"},"// ethjs wrap\nimport Eth from 'ethjs'\n\nlet web3 = null;\nlet accounts = [];\n\nif (typeof window.web3 !== 'undefined') {\n  web3 = new Eth(window.web3.currentProvider);\n\n  // get accounts\n  web3.accounts().then(accs => {\n    accounts = accs;\n  });\n} else {\n  console.error('No web3? You should consider trying MetaMask!');\n}\n\nexport {\n  accounts,\n  web3\n}\n")),(0,l.kt)("h4",{id:"\u8b1b\u89e3"},"\u8b1b\u89e3"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-js"},"if (typeof window.web3 !== 'undefined') {}\n")),(0,l.kt)("p",null,"\u7576\u7db2\u9801\u4e2d\u5b58\u5728",(0,l.kt)("inlineCode",{parentName:"p"},"window.web3"),"\u7269\u4ef6\uff0c\u53ef\u5047\u8a2d\u6b64\u700f\u89bd\u5668\u652f\u63f4DApp\u3002"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-js"},"web3 = new Eth(window.web3.currentProvider);\n")),(0,l.kt)("p",null,"\u9019\u6642\u6211\u5011\u53ef\u900f\u904e",(0,l.kt)("inlineCode",{parentName:"p"},"web3.js"),"\u6216",(0,l.kt)("inlineCode",{parentName:"p"},"Ethjs"),"\u5354\u52a9\u6211\u5011\u9023\u5230\u700f\u89bd\u5668/MetaMask\u64f4\u5145\u529f\u80fd\u5957\u4ef6\u7576\u524d\u6240\u9023\u63a5\u7684\u7db2\u8def(\u5373",(0,l.kt)("inlineCode",{parentName:"p"},"window.web3.currentProvider"),")\u3002"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-js"},"web3.accounts().then(accs => {\n  accounts = accs;\n});\n")),(0,l.kt)("p",null,"\u56e0\u70ba\u6240\u6709\u6703\u6539\u8b8a\u5340\u584a\u93c8\u4e0a\u72c0\u614b\u7684\u4ea4\u6613\u90fd\u9700\u8981\u9644\u4e0a\u4f86\u6e90\u5e33\u6236\u5730\u5740\uff0c\u56e0\u6b64\u5728\u9019\u908a\u9806\u4fbf\u53d6\u5f97\u672c\u6a5f\u7684\u6240\u6709\u5e33\u6236\u3002"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre"},"export {\n  accounts,\n  web3\n}\n")),(0,l.kt)("p",null,"\u6700\u5f8c\u532f\u51fa",(0,l.kt)("inlineCode",{parentName:"p"},"accounts"),"\u548c",(0,l.kt)("inlineCode",{parentName:"p"},"web3"),"\uff0c\u5728",(0,l.kt)("inlineCode",{parentName:"p"},"component"),"\u4e2d\u53ef\u900f\u904e",(0,l.kt)("inlineCode",{parentName:"p"},"import { accounts, web3 } from '../web3utils'"),"\u53d6\u5f97web3\u548c\u672c\u6a5f\u7684\u6240\u6709\u5e33\u6236\u3002"),(0,l.kt)("h3",{id:"appjs"},"App.js"),(0,l.kt)("p",null,(0,l.kt)("inlineCode",{parentName:"p"},"App.js"),"\u5167\u5bb9\u5982\u4e0b\uff1a"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-js"},"import React, { Component } from 'react';\nimport './App.css';\n\nimport { accounts, web3 } from './web3utils';\nimport {CONTRACT_ADDRESS} from './constants';\nimport CONTRACT_JSON from './lib/contracts/HelloToken.json';\n\nclass App extends Component {\n  constructor(props) {\n    super(props);\n    this.state = {\n      account: '',\n      balance: 0,\n      status: ''\n    };\n  }\n\n  setStateAsync(state) {\n    return new Promise((resolve) => {\n      this.setState(state, resolve)\n    });\n  }\n\n  async componentWillMount() {\n    try {\n      if (accounts.length === 0) {\n        this.setStateAsync({status: 'There was an error fetching your accounts.'});\n        return;\n      }\n\n      let account = accounts[0];\n      let token = eth.contract(CONTRACT_JSON.abi).at(CONTRACT_ADDRESS);\n      let balance = await token.balanceOf(account, {from: account});\n      this.setStateAsync({account, balance: balance.balance.toNumber() / 100});\n    } catch(err) {\n      this.setStateAsync({status: err});\n    }\n  }\n\n  render() {\n    return (\n      <div className=\"App\">\n        <header className=\"App-header\">\n          <h1 className=\"App-title\">\n          {this.state.status ? this.state.status : `Balance: ${this.state.balance} H@`}\n          </h1>\n        </header>\n        <p className=\"App-intro\">\n          Account: {this.state.account}<br/>\n        </p>\n      </div>\n    );\n  }\n}\n\nexport default App;\n")),(0,l.kt)("h4",{id:"\u8b1b\u89e3-1"},"\u8b1b\u89e3"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-js"},"import { accounts, web3 } from './web3utils';\n")),(0,l.kt)("p",null,"\u53d6\u5f97web3\u548c\u672c\u6a5f\u7684\u6240\u6709\u5e33\u6236\u3002"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-js"},"import {CONTRACT_ADDRESS} from './constants';\nimport CONTRACT_JSON from './lib/contracts/HelloToken.json';\n")),(0,l.kt)("p",null,"\u53d6\u5f97\u5408\u7d04\u5730\u5740\u548c\u5f9e",(0,l.kt)("inlineCode",{parentName:"p"},"truffle"),"\u7de8\u8b6f\u5f97\u5230\u7684JSON\u8cc7\u6599\u3002"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-js"},"class App extends Component {\n  constructor(props) {}\n  componentWillMount()\n  render()\n}\n")),(0,l.kt)("p",null,"\u900f\u904e class \u8a9e\u53e5\u5ba3\u544a React \u5143\u4ef6(component)\u3002\u5728",(0,l.kt)("inlineCode",{parentName:"p"},"constructor"),"\u5efa\u69cb\u51fd\u5f0f\u4e2d\u52a0\u5165\u9810\u8a2d\u503c\u3002\u5728",(0,l.kt)("inlineCode",{parentName:"p"},"render"),"\u51fd\u5f0f\u4e2d\u5b9a\u7fa9\u7db2\u9801\u4ecb\u9762\u4f86\u5c55\u793a\u5e33\u6236\u8207\u9918\u984d\u3002",(0,l.kt)("inlineCode",{parentName:"p"},"componentWillMount"),"\u662fReact\u63d0\u4f9b\u7684\u9810\u8a2dlifecycle\u51fd\u5f0f\u4e4b\u4e00",(0,l.kt)("sup",{parentName:"p",id:"fnref-4"},(0,l.kt)("a",{parentName:"sup",href:"#fn-4",className:"footnote-ref"},"4")),"\uff0c\u53ef\u5728\u5143\u4ef6\u5be6\u969b\u986f\u793a\u524d\u9810\u5148\u57f7\u884c\u4e00\u4e9b\u52d5\u4f5c\u3002"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-js"},"let token = eth.contract(CONTRACT_JSON.abi).at(CONTRACT_ADDRESS);\n")),(0,l.kt)("p",null,"JSON\u8cc7\u6599\u4e2d\u5b58\u6709\u6b64\u5408\u7d04\u7684ABI\u3002\u53ef\u900f\u904e",(0,l.kt)("inlineCode",{parentName:"p"},"eth.contract"),"\u51fd\u5f0f\u5c07ABI\u8f49\u63db\u6210\u6613\u65bc\u4f7f\u7528\u7684API\u3002\u900f\u904e",(0,l.kt)("inlineCode",{parentName:"p"},"at"),"\u53ef\u8a2d\u5b9a\u547c\u53eb\u6b64\u5408\u7d04\u7684\u5730\u5740\u3002"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-js"},"let balance = await token.balanceOf(account, {from: account});\nthis.setStateAsync({account, balance: balance.balance.toNumber() / 100});\n")),(0,l.kt)("p",null,"\u53d6\u5f97\u5e33\u6236\u8207\u5e33\u6236\u9918\u984d\u3002"),(0,l.kt)("p",null,"\u5b8c\u6210\u756b\u9762"),(0,l.kt)("p",null,(0,l.kt)("img",{parentName:"p",src:"https://i.imgur.com/H3UYGSU.png",alt:"Imgur"})),(0,l.kt)("h2",{id:"\u53c3\u8003\u8cc7\u6599"},"\u53c3\u8003\u8cc7\u6599"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"[1]"," Async Await with React Lifecycle methods ",(0,l.kt)("a",{parentName:"li",href:"https://medium.com/front-end-hacking/async-await-with-react-lifecycle-methods-802e7760d802"},"https://medium.com/front-end-hacking/async-await-with-react-lifecycle-methods-802e7760d802")),(0,l.kt)("li",{parentName:"ul"},"[2]"," Detect global web3 object ",(0,l.kt)("a",{parentName:"li",href:"https://github.com/MetaMask/faq/blob/master/detecting_metamask.md"},"https://github.com/MetaMask/faq/blob/master/detecting_metamask.md")),(0,l.kt)("li",{parentName:"ul"},"Calling a Smart Contract With a Button ",(0,l.kt)("a",{parentName:"li",href:"https://medium.com/metamask/calling-a-smart-contract-with-a-button-d278b1e76705"},"https://medium.com/metamask/calling-a-smart-contract-with-a-button-d278b1e76705")),(0,l.kt)("li",{parentName:"ul"},"[3]"," Ethjs User Guide ",(0,l.kt)("a",{parentName:"li",href:"https://github.com/ethjs/ethjs/blob/master/docs/user-guide.md"},"https://github.com/ethjs/ethjs/blob/master/docs/user-guide.md")),(0,l.kt)("li",{parentName:"ul"},"[4]"," React Lifecycle ",(0,l.kt)("a",{parentName:"li",href:"https://reactjs.org/docs/react-component.html"},"https://reactjs.org/docs/react-component.html")),(0,l.kt)("li",{parentName:"ul"},"[5]"," \u7bc4\u4f8b\u7db2\u5740 ",(0,l.kt)("a",{parentName:"li",href:"https://github.com/gasolin/learndapp/tree/master/examples/hello_react_dapp"},"https://github.com/gasolin/learndapp/tree/master/examples/hello_react_dapp"))))}u.isMDXComponent=!0}}]);